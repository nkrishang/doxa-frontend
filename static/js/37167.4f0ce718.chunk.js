"use strict";(self.webpackChunkdoxa_frontend=self.webpackChunkdoxa_frontend||[]).push([[37167,93431],{93431:(e,t,a)=>{function i(e){let t=[`${e.domain} wants you to sign in with your Ethereum account:`,e.address].join("\n");t=[t,e.statement].join("\n\n"),e.statement&&(t+="\n");const a=[];if(e.uri){const t=`URI: ${e.uri}`;a.push(t)}const i=`Version: ${e.version}`;if(a.push(i),e.chain_id){const t=`Chain ID: ${e.chain_id}`||"1";a.push(t)}const n=`Nonce: ${e.nonce}`;a.push(n);const s=`Issued At: ${e.issued_at}`;a.push(s);const o=`Expiration Time: ${e.expiration_time}`;if(a.push(o),e.invalid_before){const t=`Not Before: ${e.invalid_before}`;a.push(t)}e.resources&&a.push(["Resources:",...e.resources.map((e=>`- ${e}`))].join("\n"));return[t,a.join("\n")].join("\n")}async function n(e){const{payload:t,account:a}=e;return{signature:await a.signMessage({message:i(t)}),payload:t}}a.r(t),a.d(t,{signLoginPayload:()=>n})},17749:(e,t,a)=>{async function i(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}a.d(t,{B:()=>i})},37167:(e,t,a)=>{a.r(t),a.d(t,{InAppWebConnector:()=>U});var i=a(18342),n=a(22318),s=a(49703);async function o(e){let{authToken:t,client:a,ecosystem:n}=e;const o=(0,s.KI)(a,n),r=await o(`${(0,i.Wg)("inAppWallet")}/api/2024-05-05/accounts`,{method:"GET",headers:{"Content-Type":"application/json","x-thirdweb-client-id":a.clientId,Authorization:`Bearer embedded-wallet-token:${t}`}});if(!r.ok){if(401===r.status)return;const e=await r.json();throw new Error(`Failed to get user status: ${e.error}`)}return await r.json()}var r=a(89953),c=a(3340);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;return(0,c.EY)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;return globalThis.crypto.getRandomValues(new Uint8Array(e))}(e))}var d=a(86085);function h(){return`${(0,i.Wg)("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function u(e,t){return`${(0,i.Wg)("inAppWallet")}/api/2024-05-05/login/passkey?type=${e}${t?`&username=${t}`:""}`}async function g(e){if(!e.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const t=(0,s.KI)(e.client,e.ecosystem),a=e.username??(i=e.ecosystem,`${i?.id??"wallet"}-${(new Date).toISOString()}`);var i;const n=await t(u("sign-up",a)),o=await n.json();if(!o.challenge)throw new Error("No challenge received");const r=o.challenge,c=await e.passkeyClient.register({name:a,challenge:r,rp:e.rp}),l={};e.ecosystem?.partnerId&&(l["x-ecosystem-partner-id"]=e.ecosystem.partnerId),e.ecosystem?.id&&(l["x-ecosystem-id"]=e.ecosystem.id);const d=await t(h(),{method:"POST",headers:{"Content-Type":"application/json",...l},body:JSON.stringify({type:"sign-up",authenticatorData:c.authenticatorData,credentialId:c.credentialId,serverVerificationId:o.serverVerificationId,clientData:c.clientData,username:a,credential:{publicKey:c.credential.publicKey,algorithm:c.credential.algorithm},origin:c.origin,rpId:e.rp.id})}),g=await d.json();if(!g||!g.storedToken)throw new Error(`Error verifying passkey: ${g.message??"unknown error"}`);return await(e.storage?.savePasskeyCredentialId(c.credentialId)),g}var p=a(93431);var y=a(84117),m=a(9893),w=a(17749),f=a(72364),b=a(83423),v=a(93300),I=a(77717);class k{constructor(e){let{client:t,ecosystem:a,address:i,storage:n}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=a,this.address=i,this.localStorage=n}async postWalletSetUp(e){await this.localStorage.saveAuthCookie(e.storedToken.cookieString)}async getUserWalletStatus(){const e=await this.localStorage.getAuthCookie();if(!e)return{status:"Logged Out"};const t=await o({authToken:e,client:this.client,ecosystem:this.ecosystem});if(!t)return{status:"Logged Out"};const a=t.wallets[0],i={email:t.linkedAccounts.find((e=>void 0!==e.details.email))?.details.email,phoneNumber:t.linkedAccounts.find((e=>void 0!==e.details.phone))?.details.phone,userWalletId:t.id||"",recoveryShareManagement:"ENCLAVE"};return a?{status:"Logged In, Wallet Initialized",walletAddress:a.address,authDetails:i,account:await this.getAccount()}:{status:"Logged In, Wallet Uninitialized",authDetails:i}}async getAccount(){const e=this.client,t=this.localStorage,n=async n=>{const o=(0,f.getRpcClient)({client:e,chain:(0,m.Q4)(n.chainId)}),r={to:n.to??void 0,data:n.data?(0,c.nj)(n.data):void 0,value:n.value?(0,c.nj)(n.value):void 0,gas:n.gas?(0,c.nj)(n.gas+n.gas/BigInt(10)):void 0,nonce:n.nonce?(0,c.nj)(n.nonce):(0,c.nj)(await a.e(37338).then(a.bind(a,37338)).then((e=>{let{eth_getTransactionCount:t}=e;return t(o,{address:this.address,blockTag:"pending"})}))),chainId:(0,c.nj)(n.chainId)};return n.maxFeePerGas?(r.maxFeePerGas=(0,c.nj)(n.maxFeePerGas),r.maxPriorityFeePerGas=n.maxPriorityFeePerGas?(0,c.nj)(n.maxPriorityFeePerGas):void 0,r.type=2):(r.gasPrice=n.gasPrice?(0,c.nj)(n.gasPrice):void 0,r.type=0),async function(e){let{client:t,payload:a,storage:n}=e;const o=await n.getAuthCookie(),r=n.ecosystem,c=(0,s.KI)(t,r);if(!o)throw new Error("No auth token found when signing transaction");const l=await c(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/sign-transaction`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:`Bearer embedded-wallet-token:${o}`},body:(0,I.A)({transactionPayload:a})});if(!l.ok)throw new Error("Failed to sign transaction");return(await l.json()).signature}({client:e,storage:t,payload:r})};return{address:(0,b.bv)(this.address),async signTransaction(e){if(!e.chainId)throw new Error("chainId required in tx to sign");return n({chainId:e.chainId,...e})},async sendTransaction(t){const a=(0,f.getRpcClient)({client:e,chain:(0,m.Q4)(t.chainId)}),i=await n(t);return{transactionHash:await(0,w.B)(a,i)}},async signMessage(a){let{message:n}=a;const o="string"===typeof n?{message:n,isRaw:!1}:{message:"string"===typeof n.raw?n.raw:(0,y.My)(n.raw),isRaw:!0},{signature:r}=await async function(e){let{client:t,payload:{message:a,isRaw:n},storage:o}=e;const r=await o.getAuthCookie(),c=o.ecosystem,l=(0,s.KI)(t,c);if(!r)throw new Error("No auth token found when signing message");const d=await l(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/sign-message`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:`Bearer embedded-wallet-token:${r}`},body:(0,I.A)({messagePayload:{message:a,isRaw:n}})});if(!d.ok)throw new Error("Failed to sign message");return await d.json()}({client:e,payload:o,storage:t});return r},async signTypedData(a){const n=(0,v.y)(a),{signature:o}=await async function(e){let{client:t,payload:a,storage:n}=e;const o=await n.getAuthCookie(),r=n.ecosystem,c=(0,s.KI)(t,r);if(!o)throw new Error("No auth token found when signing typed data");const l=await c(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/sign-typed-data`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:`Bearer embedded-wallet-token:${o}`},body:(0,I.A)({...a})});if(!l.ok)throw new Error("Failed to sign typed data");return await l.json()}({client:e,payload:n,storage:t});return o}}}}var W=a(387),S=a(62600);const L={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none",pointerEvents:"all"},T=new Map;class C{constructor(e){let{link:t,baseUrl:a,iframeId:i,container:n=document.body,onIframeInitialize:s,localStorage:o,clientId:r,ecosystem:c}=e;Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.localStorage=o,this.clientId=r,this.ecosystem=c,this.iframeBaseUrl=a;let l=document.getElementById(i);const d=new URL(t);if(!l||l.src!==d.href){l=document.createElement("iframe");const e={...L};Object.assign(l.style,e),l.setAttribute("id",i),l.setAttribute("fetchpriority","high"),n.appendChild(l),l.src=d.href;const t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!l)return void console.warn("thirdweb iFrame not found");this.onIframeLoadHandler(l,s)()}};window.addEventListener("message",t)}this.iframe=l}async onIframeLoadedInitVariables(){return{authCookie:await this.localStorage.getAuthCookie(),deviceShareStored:await this.localStorage.getDeviceShare(),walletUserId:await this.localStorage.getWalletUserId(),clientId:this.clientId,partnerId:this.ecosystem?.partnerId,ecosystemId:this.ecosystem?.id}}onIframeLoadHandler(e,t){return async()=>{const a=new MessageChannel,i=new Promise(((i,n)=>{a.port1.onmessage=s=>{const{data:o}=s;a.port1.close(),o.success||n(new Error(o.error)),T.set(e.src,!0),t&&t(),i(!0)}}));e?.contentWindow?.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await i}}async call(e){let{procedureName:t,params:a,showIframe:i=!1}=e;for(;!T.get(this.iframe.src);)await(0,S.y)(1e3*this.POLLING_INTERVAL_SECONDS);i&&(this.iframe.style.display="block",await(0,S.y)(5));const n=new MessageChannel,s=new Promise(((e,t)=>{n.port1.onmessage=async a=>{const{data:s}=a;n.port1.close(),i&&(await(0,S.y)(100),this.iframe.style.display="none"),s.success?e(s.data):t(new Error(s.error))}}));return this.iframe.contentWindow?.postMessage({eventType:t,data:{...a,...await this.onIframeLoadedInitVariables()}},this.iframeBaseUrl,[n.port2]),s}destroy(){T.delete(this.iframe.src)}}class O extends C{constructor(e){let{clientId:t,baseUrl:a,ecosystem:i}=e;super({iframeId:P+(i?.id||""),link:j({clientId:t,path:W.CW,ecosystem:i,baseUrl:a}).href,baseUrl:a,container:document.body,localStorage:new r.t({storage:n.n,clientId:t,ecosystem:i}),clientId:t,ecosystem:i}),this.clientId=t,this.ecosystem=i}}function j(e){let{clientId:t,baseUrl:a,path:i,ecosystem:n,queryParams:s}=e;const o=new URL(`${i}`,a);if(s)for(const r of Object.keys(s))o.searchParams.set(r,s[r]?.toString()||"");return o.searchParams.set("clientId",t),void 0!==n?.partnerId&&o.searchParams.set("partnerId",n.partnerId),void 0!==n?.id&&o.searchParams.set("ecosystemId",n.id),o}const P="thirdweb-in-app-wallet-iframe";class A{constructor(e){let{baseUrl:t,querier:a,preLogin:i,postLogin:n,client:s,ecosystem:o}=e;Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=t,this.LoginQuerier=a,this.preLogin=i,this.postLogin=n,this.client=s,this.ecosystem=o}async sendEmailLoginOtp(e){let{email:t}=e;return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:t}})}}class E extends A{async authenticateWithModal(){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0})}async loginWithModal(){await this.preLogin();const e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe(e){let{email:t}=e;return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0})}async loginWithIframe(e){let{email:t}=e;await this.preLogin();const a=await this.authenticateWithIframe({email:t});return this.postLogin(a)}async authenticateWithCustomJwt(e){let{encryptionKey:t,jwt:a}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:a}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:a}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");await this.preLogin();const i=await this.authenticateWithCustomJwt({encryptionKey:t,jwt:a});return this.postLogin(i)}async authenticateWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:a}=e;return this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:a}})}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:a}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom auth");await this.preLogin();const i=await this.authenticateWithCustomAuthEndpoint({encryptionKey:t,payload:a});return this.postLogin(i)}async authenticateWithEmailOtp(e){let{email:t,otp:a,recoveryCode:i}=e;return this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:a,recoveryCode:i}})}async loginWithEmailOtp(e){let{email:t,otp:a,recoveryCode:i}=e;const n=await this.authenticateWithEmailOtp({email:t,otp:a,recoveryCode:i});return this.postLogin(n)}async authenticateWithSmsOtp(e){let{phoneNumber:t,otp:a,recoveryCode:i}=e;return this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:t,otp:a,recoveryCode:i}})}async loginWithSmsOtp(e){let{phoneNumber:t,otp:a,recoveryCode:i}=e;const n=await this.authenticateWithSmsOtp({phoneNumber:t,otp:a,recoveryCode:i});return this.postLogin(n)}}class N{constructor(e){let{client:t,querier:a,onAuthSuccess:i,ecosystem:n,baseUrl:s,localStorage:o}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=n,this.AuthQuerier=a,this.localStorage=o,this.onAuthSuccess=i,this.BaseLogin=new E({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},ecosystem:n,querier:a,client:t,baseUrl:s})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:a}=e;t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:a})}async loginWithAuthToken(e,t){await this.preLogin();const a=await o({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!a)throw new Error("Cannot login, no user found for auth token");if(a.wallets.length>0&&"enclave"===a.wallets[0]?.type)return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:a.wallets[0].address}});if(0===a.wallets.length&&this.ecosystem){const t=await async function(e){let{authToken:t,client:a,ecosystem:n}=e;const o=(0,s.KI)(a,n),r=await o(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/generate`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":a.clientId,Authorization:`Bearer embedded-wallet-token:${t}`}});if(!r.ok)throw new Error("Failed to generate wallet");const{wallet:c}=await r.json();return c}({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:t.address}})}const n=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(n)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){this.AuthQuerier&&await this.AuthQuerier.call({procedureName:"logout",params:void 0});const e=await this.localStorage.removeAuthCookie(),t=await this.localStorage.removeWalletUserId();return{success:e||t}}}var D=a(9142);const $=async e=>{const{client:t,ecosystem:a}=e,i=(0,d.K)({authOption:e.strategy,client:e.client,ecosystem:e.ecosystem}),n={"Content-Type":"application/json","x-client-id":t.clientId};a?.id&&(n["x-ecosystem-id"]=a.id),a?.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);const s=(()=>{switch(e.strategy){case"email":return{email:e.email,code:e.verificationCode};case"phone":return{phone:e.phoneNumber,code:e.verificationCode}}})(),o=await fetch(i,{method:"POST",headers:n,body:JSON.stringify(s)});if(!o.ok)throw new Error("Failed to verify verification code");return await o.json()};class x{constructor(e){let{client:t,ecosystem:a,querier:i,localStorage:n}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=a,this.walletManagerQuerier=i,this.localStorage=n}async postWalletSetUp(e){e.deviceShareStored&&await this.localStorage.saveDeviceShare(e.deviceShareStored,e.storedToken.authDetails.userWalletId)}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return"Logged In, Wallet Initialized"===e.status?{status:"Logged In, Wallet Initialized",...e.user,account:await this.getAccount()}:"Logged In, New Device"===e.status?{status:"Logged In, New Device",...e.user}:"Logged In, Wallet Uninitialized"===e.status?{status:"Logged In, Wallet Uninitialized",...e.user}:{status:e.status}}async getAccount(){const e=this.walletManagerQuerier,t=this.client,a=this.ecosystem?.partnerId,{address:n}=await e.call({procedureName:"getAddress",params:void 0}),s=async t=>{const n={to:t.to??void 0,data:t.data,value:t.value,gasLimit:t.gas,nonce:t.nonce,chainId:t.chainId};t.maxFeePerGas?(n.accessList=t.accessList,n.maxFeePerGas=t.maxFeePerGas,n.maxPriorityFeePerGas=t.maxPriorityFeePerGas,n.type=2):(n.gasPrice=t.gasPrice,n.type=0);const s=(0,i.JD)().rpc,{signedTransaction:o}=await e.call({procedureName:"signTransaction",params:{transaction:n,chainId:t.chainId,partnerId:a,rpcEndpoint:`https://${t.chainId}.${s}`}});return o};return{address:(0,b.bv)(n),async signTransaction(e){if(!e.chainId)throw new Error("chainId required in tx to sign");return s({...e,chainId:e.chainId})},async sendTransaction(e){const a=(0,f.getRpcClient)({client:t,chain:(0,m.Q4)(e.chainId)}),i=await s(e);return{transactionHash:await(0,w.B)(a,i)}},async signMessage(t){let{message:i}=t;const n="string"===typeof i?i:i.raw instanceof Uint8Array?i.raw:(0,c.IQ)(i.raw),{signedMessage:s}=await e.call({procedureName:"signMessage",params:{message:n,partnerId:a,chainId:1}});return s},async signTypedData(t){const n=(0,v.y)(t);n.types?.EIP712Domain&&(n.types.EIP712Domain=void 0);const s=n.domain,o=s?.chainId,r={...s?.verifyingContract?{verifyingContract:s?.verifyingContract}:{},name:s?.name,version:s?.version};o&&(r.chainId=o);const c=(0,i.JD)().rpc,{signedTypedData:l}=await e.call({procedureName:"signTypedDataV4",params:{domain:r,types:n.types,message:n.message,chainId:o||1,partnerId:a,rpcEndpoint:`https://${o}.${c}`}});return l}}}}class U{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor(e){let{client:t,onAuthSuccess:a,ecosystem:s,passkeyDomain:o}=e;if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(t.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const c=(0,i.Wg)("inAppWallet");this.client=t,this.ecosystem=s,this.passkeyDomain=o,this.storage=new r.t({storage:n.n,clientId:t.clientId,ecosystem:s}),this.querier=new O({clientId:t.clientId,ecosystem:s,baseUrl:c}),this.auth=new N({client:t,querier:this.querier,baseUrl:c,localStorage:this.storage,ecosystem:s,onAuthSuccess:async e=>{if(a?.(e),this.ecosystem&&"sharded"===e.storedToken.authDetails.walletType){if(!await this.querier.call({procedureName:"migrateFromShardToEnclave",params:{storedToken:e.storedToken}}))throw new Error("Failed to migrate from sharded to enclave wallet")}if(await this.initializeWallet(e.storedToken.cookieString),!this.wallet)throw new Error("Failed to initialize wallet");const t="deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:void 0;return await this.wallet.postWalletSetUp({storedToken:e.storedToken,deviceShareStored:t}),"enclave"!==e.storedToken.authDetails.walletType&&await this.querier.call({procedureName:"initIframe",params:{partnerId:s?.partnerId,ecosystemId:s?.id,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:null,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:"Logged In, Wallet Initialized",authDetails:e.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:e.walletDetails.walletAddress}}}})}async initializeWallet(e){const t=await this.storage.getAuthCookie();if(!e&&null===t)throw new Error("No auth token provided and no stored auth token found to initialize the wallet");const a=await o({authToken:e||t,client:this.client,ecosystem:this.ecosystem});if(!a)throw new Error("Cannot initialize wallet, no user logged in");if(0===a.wallets.length)throw new Error("Cannot initialize wallet, this user does not have a wallet generated yet");"enclave"!==a.wallets[0]?.type?this.wallet=new x({client:this.client,ecosystem:this.ecosystem,querier:this.querier,localStorage:this.storage}):this.wallet=new k({client:this.client,ecosystem:this.ecosystem,address:a.wallets[0].address,storage:this.storage})}async getUser(){if(!this.wallet){const e=await this.storage.getAuthCookie();if(!e)return{status:"Logged Out"};await this.initializeWallet(e)}if(!this.wallet)throw new Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw new Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(e){return(async e=>{const{client:t,ecosystem:a}=e,i=(0,d.f)({client:t,ecosystem:a,authOption:e.strategy}),n={"Content-Type":"application/json","x-client-id":t.clientId};a?.id&&(n["x-ecosystem-id"]=a.id),a?.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);const s=(()=>{switch(e.strategy){case"email":return{email:e.email};case"phone":return{phone:e.phoneNumber}}})(),o=await fetch(i,{method:"POST",headers:n,body:JSON.stringify(s)});if(!o.ok)throw new Error("Failed to send verification code");return await o.json()})({...e,client:this.client,ecosystem:this.ecosystem})}authenticateWithRedirect(e,t,a){(0,D.N)({authOption:e,client:this.client,ecosystem:this.ecosystem,redirectUrl:a,mode:t})}async loginWithAuthToken(e){return this.auth.loginWithAuthToken(e)}async authenticate(e){const t=e.strategy;switch(t){case"email":case"phone":return $({...e,client:this.client,ecosystem:this.ecosystem});case"jwt":return this.auth.authenticateWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"passkey":return this.passkeyAuth(e);case"auth_endpoint":return this.auth.authenticateWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"twitch":case"farcaster":case"line":case"x":case"coinbase":case"discord":return(0,D.x)({authOption:t,client:this.client,ecosystem:this.ecosystem,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow});case"guest":return async function(e){const t=new r.t({storage:e.storage,clientId:e.client.clientId,ecosystem:e.ecosystem});let a=await t.getGuestSessionId();a||(a=l(32),t.saveGuestSessionId(a));const i=(0,s.KI)(e.client,e.ecosystem);return await(async()=>{const t=(0,d.K)({authOption:"guest",client:e.client,ecosystem:e.ecosystem}),n=await i(`${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:a})});if(!n.ok)throw new Error("Failed to generate guest account");return await n.json()})()}({client:this.client,ecosystem:this.ecosystem,storage:n.n});case"wallet":return async function(e){const{wallet:t,chain:a}=e,i=await t.connect({client:e.client}),n=(0,s.KI)(e.client,e.ecosystem),o=await(async()=>{const t=(0,d.f)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),s=await n(`${t}&address=${i.address}&chainId=${a.id}`);if(!s.ok)throw new Error("Failed to generate SIWE login payload");return await s.json()})(),{signature:r}=await(0,p.signLoginPayload)({payload:o,account:i});return await(async()=>{const t=(0,d.K)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),a=await n(`${t}&signature=${r}&payload=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signature:r,payload:o})});if(!a.ok)throw new Error("Failed to verify SIWE signature");return await a.json()})()}({ecosystem:this.ecosystem,client:this.client,wallet:e.wallet,chain:e.chain})}}async connect(e){const t=e.strategy;switch(t){case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{const t=await this.passkeyAuth(e);return this.loginWithAuthToken(t)}case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"line":case"x":case"guest":case"coinbase":case"twitch":case"discord":{const t=await this.authenticate(e);return await this.auth.loginWithAuthToken(t)}default:!function(e,t){throw new Error(t??`Invalid param: ${e}`)}(t)}}async logout(){return await this.auth.logout()}async passkeyAuth(e){const{PasskeyWebClient:t}=await Promise.resolve().then(a.bind(a,63109)),{passkeyName:i,storeLastUsedPasskey:n=!0}=e,o=new t,r=this.storage;return"sign-up"===e.type?g({client:this.client,ecosystem:this.ecosystem,username:i,passkeyClient:o,storage:n?r:void 0,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title}}):async function(e){if(!e.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const t=(0,s.KI)(e.client,e.ecosystem),a=await t(u("sign-in")),i=await a.json();if(!i.challenge)throw new Error("No challenge received");const n=i.challenge,o=await(e.storage?.getPasskeyCredentialId())??void 0,r=await e.passkeyClient.authenticate({credentialId:o,challenge:n,rp:e.rp}),c={};e.ecosystem?.partnerId&&(c["x-ecosystem-partner-id"]=e.ecosystem.partnerId),e.ecosystem?.id&&(c["x-ecosystem-id"]=e.ecosystem.id);const l=await t(h(),{method:"POST",headers:{"Content-Type":"application/json",...c},body:JSON.stringify({type:"sign-in",authenticatorData:r.authenticatorData,credentialId:r.credentialId,serverVerificationId:i.serverVerificationId,clientData:r.clientData,signature:r.signature,origin:r.origin,rpId:e.rp.id})}),d=await l.json();if(!d||!d.storedToken)throw new Error(`Error verifying passkey: ${d.message??"unknown error"}`);return await(e.storage?.savePasskeyCredentialId(r.credentialId)),d}({client:this.client,ecosystem:this.ecosystem,passkeyClient:o,storage:n?r:void 0,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title}})}async linkProfile(e){const{storedToken:t}=await this.authenticate(e);return await async function(e){let{client:t,ecosystem:a,tokenToLink:n,storage:o}=e;const r=(0,s.KI)(t,a),c=(0,i.Wg)("inAppWallet"),l=await o.getAuthCookie();if(!l)throw new Error("Failed to link account, no user logged in");const d={Authorization:`Bearer iaw-auth-token:${l}`,"Content-Type":"application/json"},h=await r(`${c}/api/2024-05-05/account/connect`,{method:"POST",headers:d,body:JSON.stringify({accountAuthTokenToConnect:n})});if(!h.ok){const e=await h.json();throw new Error(e.message||"Failed to link account.")}const{linkedAccounts:u}=await h.json();return u??[]}({client:e.client,tokenToLink:t.cookieString,storage:this.storage,ecosystem:e.ecosystem||this.ecosystem})}async getProfiles(){return async function(e){let{client:t,ecosystem:a,storage:n}=e;const o=(0,s.KI)(t,a),r=(0,i.Wg)("inAppWallet"),c=await n.getAuthCookie();if(!c)throw new Error("Failed to get linked accounts, no user logged in");const l={Authorization:`Bearer iaw-auth-token:${c}`,"Content-Type":"application/json"},d=await o(`${r}/api/2024-05-05/accounts`,{method:"GET",headers:l});if(!d.ok){const e=await d.json();throw new Error(e.message||"Failed to get linked accounts.")}const{linkedAccounts:h}=await d.json();return h??[]}({client:this.client,ecosystem:this.ecosystem,storage:this.storage})}}}}]);
//# sourceMappingURL=37167.4f0ce718.chunk.js.map